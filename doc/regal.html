<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.9">
<meta name="author" content="Jan Schnasse">
<title>Regal</title>
<style>
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

object, svg { display: inline-block; vertical-align: middle; }

.center { margin-left: auto; margin-right: auto; }

.stretch { width: 100%; }

p.lead { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #6f6f6f; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #2ba6cb; text-decoration: none; line-height: inherit; }
a:hover, a:focus { color: #2795b6; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: bold; font-style: normal; color: #222222; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #6f6f6f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; color: #7f0a0c; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 1.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }

blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

body { -moz-osx-font-smoothing: grayscale; -webkit-font-smoothing: antialiased; tab-size: 4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

:not(pre):not([class^=L]) > code { font-size: inherit; font-style: normal !important; letter-spacing: 0; padding: 0; line-height: inherit; word-wrap: break-word; }

:not(pre) > code.nobreak { word-wrap: normal; }
:not(pre) > code.nowrap { white-space: nowrap; }

pre { color: black; font-family: monospace, serif; line-height: 1.4; }
pre code, pre pre { color: inherit; font-size: inherit; line-height: inherit; }
pre > code { display: block; }

pre.nowrap, pre.nowrap pre { white-space: pre; word-wrap: normal; }

em em { font-style: normal; }

strong strong { font-weight: normal; }

.keyseq { color: #555555; }

kbd { font-family: Consolas, "Liberation Mono", Courier, monospace; display: inline-block; color: #222222; font-size: 0.65em; line-height: 1.45; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: 0 0.15em; padding: 0.2em 0.5em; vertical-align: middle; position: relative; top: -0.1em; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menuref { color: #000; }

.menuseq b:not(.caret), .menuref { font-weight: inherit; }

.menuseq { word-spacing: -0.02em; }
.menuseq b.caret { font-size: 1.25em; line-height: 0.8; }
.menuseq i.caret { font-weight: bold; text-align: center; width: 0.45em; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: black; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #dddddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #dddddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #dddddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #555555; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #6f6f6f; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #6f6f6f; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: black; border-bottom: 1px solid #dddddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#toc { border-bottom: 1px solid #dddddd; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; list-style-type: none; }
#toc li { line-height: 1.3334; margin-top: 0.3334em; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #6f6f6f; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background: #f2f2f2; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; margin-bottom: 0.8rem; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background: #222222; padding: 1.25em; }

#footer-text { color: #dddddd; line-height: 1.44; }

#content { margin-bottom: 0.625em; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { #content { margin-bottom: 1.25em; }
  .sect1 { padding-bottom: 1.25em; } }
.sect1:last-child { padding-bottom: 0; }

.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #222222; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #151515; }

details, .audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

details > summary:first-of-type { cursor: pointer; display: list-item; outline: none; margin-bottom: 0.75em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock.fit-content > caption.title { white-space: nowrap; width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > [class="paragraph"]:first-of-type p { font-size: 1.21875em; line-height: 1.6; color: black; }

table.tableblock #preamble > .sectionbody > [class="paragraph"]:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #555555; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d4d4d4; margin-bottom: 1.25em; padding: 1.25em; background: #ededed; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #6f6f6f; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock > .content > pre { border: 1px solid #cccccc; -webkit-border-radius: 0; border-radius: 0; word-wrap: break-word; overflow-x: auto; padding: 0.8em 0.8em 0.65em 0.8em; font-size: 0.8125em; }
@media only screen and (min-width: 768px) { .literalblock pre, .listingblock > .content > pre { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .listingblock > .content > pre { font-size: 1em; } }

.literalblock pre, .listingblock > .content > pre:not(.highlight), .listingblock > .content > pre[class="highlight"], .listingblock > .content > pre[class^="highlight "] { background: #eeeeee; }

.literalblock.output pre { color: #eeeeee; background-color: black; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: inherit; opacity: 0.5; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: inherit; opacity: 0.5; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 0.8em 0.8em 0.65em 0.8em; -webkit-border-radius: 0; border-radius: 0; }

.prettyprint { background: #eeeeee; }

pre.prettyprint .linenums { line-height: 1.4; margin-left: 2em; }

pre.prettyprint li { background: none; list-style-type: inherit; padding-left: 0; }

pre.prettyprint li code[data-lang]:before { opacity: 1; }

pre.prettyprint li:not(:first-child) code[data-lang]:before { display: none; }

table.linenotable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }
table.linenotable td[class] { color: inherit; vertical-align: top; padding: 0; line-height: inherit; white-space: normal; }
table.linenotable td.code { padding-left: 0.75em; }
table.linenotable td.linenos { border-right: 1px solid currentColor; opacity: 0.35; padding-right: 0.5em; }

pre.pygments .lineno { border-right: 1px solid currentColor; opacity: 0.35; display: inline-block; margin-right: 0.75em; }
pre.pygments .lineno:before { content: ""; margin-right: -0.125em; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock:not(.excerpt) > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock p { color: #6f6f6f; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #6f6f6f; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.75em; margin-right: 0.5ex; text-align: right; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #6f6f6f; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.025em; color: #555555; }

.quoteblock.abstract blockquote:before, .quoteblock.excerpt blockquote:before, .quoteblock .quoteblock blockquote:before { display: none; }
.quoteblock.abstract blockquote, .quoteblock.abstract p, .quoteblock.excerpt blockquote, .quoteblock.excerpt p, .quoteblock .quoteblock blockquote, .quoteblock .quoteblock p { line-height: 1.6; word-spacing: 0; }
.quoteblock.abstract { margin: 0 1em 1.25em 1em; display: block; }
.quoteblock.abstract > .title { margin: 0 0 0.375em 0; font-size: 1.15em; text-align: center; }
.quoteblock.excerpt > blockquote, .quoteblock .quoteblock { padding: 0 0 0.25em 1em; border-left: 0.25em solid #dddddd; }
.quoteblock.excerpt, .quoteblock .quoteblock { margin-left: 0; }
.quoteblock.excerpt blockquote, .quoteblock.excerpt p, .quoteblock .quoteblock blockquote, .quoteblock .quoteblock p { color: inherit; font-size: 1.0625rem; }
.quoteblock.excerpt .attribution, .quoteblock .quoteblock .attribution { color: inherit; text-align: left; margin-right: 0; }

table.tableblock { max-width: 100%; border-collapse: separate; }

p.tableblock:last-child { margin-bottom: 0; }

td.tableblock > .content > :last-child { margin-bottom: -1.25em; }
td.tableblock > .content > :last-child.sidebarblock { margin-bottom: 0; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dddddd; }

table.grid-all > thead > tr > .tableblock, table.grid-all > tbody > tr > .tableblock { border-width: 0 1px 1px 0; }

table.grid-all > tfoot > tr > .tableblock { border-width: 1px 1px 0 0; }

table.grid-cols > * > tr > .tableblock { border-width: 0 1px 0 0; }

table.grid-rows > thead > tr > .tableblock, table.grid-rows > tbody > tr > .tableblock { border-width: 0 0 1px 0; }

table.grid-rows > tfoot > tr > .tableblock { border-width: 1px 0 0 0; }

table.grid-all > * > tr > .tableblock:last-child, table.grid-cols > * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-all > tbody > tr:last-child > .tableblock, table.grid-all > thead:last-child > tr > .tableblock, table.grid-rows > tbody > tr:last-child > .tableblock, table.grid-rows > thead:last-child > tr > .tableblock { border-bottom-width: 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot, table.frame-ends { border-width: 1px 0; }

table.stripes-all tr, table.stripes-odd tr:nth-of-type(odd), table.stripes-even tr:nth-of-type(even), table.stripes-hover tr:hover { background: #f9f9f9; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.4; background: whitesmoke; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

ol { margin-left: 1.75em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.checklist, ul.none, ol.none, ul.no-bullet, ol.no-bullet, ol.unnumbered, ul.unstyled, ol.unstyled { list-style-type: none; }

ul.no-bullet, ol.no-bullet, ol.unnumbered { margin-left: 0.625em; }

ul.unstyled, ol.unstyled { margin-left: 0; }

ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-square-o:first-child, ul.checklist li > p:first-child > .fa-check-square-o:first-child { width: 1.25em; font-size: 0.8em; position: relative; bottom: 0.125em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.inline { display: -ms-flexbox; display: -webkit-box; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; list-style: none; margin: 0 0 0.625em -1.25em; }

ul.inline > li { margin-left: 1.25em; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1, td.hdlist2 { vertical-align: top; padding: 0 0.625em; }

td.hdlist1 { font-weight: bold; padding-bottom: 1.25em; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist td:not([class]):first-child { padding: 0.4em 0.75em 0 0.75em; line-height: 1; vertical-align: top; }
.colist td:not([class]):first-child img { max-width: none; }
.colist td:not([class]):last-child { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; display: inline-block; }
a.image object { pointer-events: none; }

sup.footnote, sup.footnoteref { font-size: 0.875em; position: static; vertical-align: super; }
sup.footnote a, sup.footnoteref a { text-decoration: none; }
sup.footnote a:active, sup.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -0.25em 0 0.75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em 0 0.225em; line-height: 1.3334; font-size: 0.875em; margin-left: 1.2em; margin-bottom: 0.2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; margin-left: -1.05em; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }
a span.icon > .fa { cursor: inherit; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #207c98; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

.literalblock pre, .listingblock pre { background: #eeeeee; }

</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Regal</h1>
<div class="details">
<span id="author" class="author">Jan Schnasse</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_einleitung">1. Einleitung</a></li>
<li><a href="#_konzepte">2. Konzepte</a>
<ul class="sectlevel2">
<li><a href="#_objektmodell">2.1. Objektmodell</a></li>
<li><a href="#_namespaces_und_identifier">2.2. Namespaces und Identifier</a></li>
<li><a href="#_deskriptive_metadaten">2.3. Deskriptive Metadaten</a></li>
<li><a href="#_anzeige_und_darstellung">2.4. Anzeige und Darstellung</a></li>
<li><a href="#_der_hbz_verbundkatalog">2.5. Der hbz-Verbundkatalog</a></li>
<li><a href="#_metadatenkonvertierung">2.6. Metadatenkonvertierung</a></li>
<li><a href="#_oai_providing">2.7. OAI-Providing</a></li>
<li><a href="#_suche">2.8. Suche</a></li>
<li><a href="#_zugriffsberechtigungen_und_sichtbarkeiten">2.9. Zugriffsberechtigungen und Sichtbarkeiten</a></li>
<li><a href="#_benutzerverwaltung">2.10. Benutzerverwaltung</a></li>
<li><a href="#_ansichten">2.11. Ansichten</a></li>
</ul>
</li>
<li><a href="#_software">3. Software</a>
<ul class="sectlevel2">
<li><a href="#_regal_api_2">3.1. regal-api</a></li>
<li><a href="#_etikett">3.2. etikett</a></li>
<li><a href="#_zettel">3.3. zettel</a></li>
<li><a href="#_skos_lookup">3.4. skos-lookup</a></li>
<li><a href="#_thumby">3.5. thumby</a></li>
<li><a href="#_deepzoomer">3.6. deepzoomer</a></li>
<li><a href="#_regal_drupal">3.7. regal-drupal</a></li>
<li><a href="#_edoweb_drupal_theme">3.8. edoweb-drupal-theme</a></li>
<li><a href="#_zbmed_drupal_theme">3.9. zbmed-drupal-theme</a></li>
<li><a href="#_openwayback">3.10. openwayback</a></li>
<li><a href="#_heritrix">3.11. heritrix</a></li>
<li><a href="#_wpull">3.12. wpull</a></li>
<li><a href="#_fedora_commons_3">3.13. Fedora Commons 3</a></li>
<li><a href="#_mysql">3.14. MySql</a></li>
<li><a href="#_elasticsearch_1_1">3.15. Elasticsearch 1.1</a></li>
<li><a href="#_drupal_7">3.16. Drupal 7</a></li>
</ul>
</li>
<li><a href="#_installation">4. Installation</a>
<ul class="sectlevel2">
<li><a href="#_vagrant">4.1. Vagrant</a></li>
<li><a href="#_server">4.2. Server</a></li>
</ul>
</li>
<li><a href="#_administration">5. Administration</a>
<ul class="sectlevel2">
<li><a href="#_aktualisierung">5.1. Aktualisierung</a></li>
<li><a href="#_verzeichnisse">5.2. Verzeichnisse</a></li>
<li><a href="#_ports">5.3. Ports</a></li>
<li><a href="#_logs">5.4. Logs</a></li>
<li><a href="#_configs">5.5. Configs</a></li>
<li><a href="#_apache2">5.6. Apache2</a></li>
<li><a href="#_matomo">5.7. Matomo</a></li>
<li><a href="#_monit">5.8. Monit</a></li>
<li><a href="#_scripts_und_cronjobs">5.9. Scripts und Cronjobs</a></li>
</ul>
</li>
<li><a href="#_dokumentation">6. Dokumentation</a>
<ul class="sectlevel2">
<li><a href="#_diese_repo_herunterladen">6.1. Diese Repo herunterladen</a></li>
<li><a href="#_asciidoctor_und_asciidoctor_stylesheets_installieren">6.2. Asciidoctor und Asciidoctor-Stylesheets installieren</a></li>
<li><a href="#_doku_modifizieren_und_in_html_übersetzen">6.3. Doku modifizieren und in HTML übersetzen</a></li>
</ul>
</li>
<li><a href="#_license">7. License</a></li>
<li><a href="#_links">8. Links</a>
<ul class="sectlevel2">
<li><a href="#_slides">8.1. Slides</a></li>
<li><a href="#_internes_wiki">8.2. Internes Wiki</a></li>
<li><a href="#_github">8.3. Github</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Über dieses Dokument</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Dieses Dokument kommt zusammen mit einem <a href="https://github.com/jschnasse/Regal/tree/master/vagrant/ubuntu-14.04">Vagrantfile</a> und beschreibt eine typische Installation von Regal. Unter <a href="#_vagrant">Vagrant</a> findet sich eine Anleitung zur Installation in einer Virtualbox.</p>
</div>
<div class="paragraph">
<p>Dieses Dokument ist im Format asciidoc geschrieben und kann mit dem Werkzeug asciidoctor in HTML übersetzt werden. Mehr dazu im Abschnitt <a href="#_dokumentation">Dokumentation</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_einleitung">1. Einleitung</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Regal ist eine ContentRepository zur Verwaltung und Veröffentlichung elektronischer Publikationen. Es wird seit 2013 am <a href="https://hbz-nrw.de">Hochschulbibliothekszentrum (hbz)</a> entwickelt.</p>
</div>
<div class="paragraph">
<p>Regal basiert auf den folgenden Kerntechnologien:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Fedora Commons 3</p>
</li>
<li>
<p>Elasticsearch 1.1</p>
</li>
<li>
<p>Drupal 7</p>
</li>
<li>
<p>Playframework 2.4</p>
</li>
<li>
<p>MySQL 5</p>
</li>
<li>
<p>Java 8</p>
</li>
<li>
<p>PHP 5</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Für die Webarchivierung kommen außerdem Openwayback, Heritrix und WPull zum Einsatz.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>openwayback hbz-2.3.2</p>
</li>
<li>
<p>heritrix 3.2.0</p>
</li>
<li>
<p>wpull</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Regal ist ein mehrkomponentiges System. Einzelne Komponenten sind als Webservices realisiert und kommunizieren über HTTP-APIs miteinander. Derzeit sind folgende Komponenten im Einsatz</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/edoweb/regal-api">regal-api</a></p>
</li>
<li>
<p><a href="https://github.com/hbz/etikett">etikett</a></p>
</li>
<li>
<p><a href="https://github.com/hbz/zettel">zettel</a></p>
</li>
<li>
<p><a href="https://github.com/hbz/skos-lookup">skos-lookup</a></p>
</li>
<li>
<p><a href="https://github.com/hbz/thumby">thumby</a></p>
</li>
<li>
<p><a href="https://github.com/hbz/DeepZoomService/">deepzoomer</a></p>
</li>
<li>
<p><a href="https://github.com/edoweb/regal-drupal">regal-drupal</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Drupal Themes</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/edoweb/zbmed-drupal-theme">zbmed-drupal-theme</a></p>
</li>
<li>
<p><a href="https://github.com/edoweb/edoweb-drupal-theme">edoweb-drupal-theme</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Über die Systemschnittstellen können eine ganze Reihe von Drittsystemen angesprochen werden. Die folgende Abbildung verschafft einen groben Überblick über eine typische Regal-Installation und die angebundenen Drittsysteme.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./resources/images/regal-arch-4.jpeg" alt="Regal Überblick">
</div>
<div class="title">Figure 1. Typische Regal-Installation mit Drupal Frontend, Backendkomponenten und angebundenen Drittsytemen</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_konzepte">2. Konzepte</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_objektmodell">2.1. Objektmodell</h3>
<div class="paragraph">
<p>Regal realisiert ein einheitliches Objektmodell in dem sich eine Vielzahl von Publikationstypen speichern lassen. Die Speicherschicht wird über <a href="#_fedora_commons_3">Fedora Commons 3</a> realisiert.</p>
</div>
<div class="paragraph">
<p>Eine einzelne Publikation besteht i.d.R. aus mehreren <a href="#_fedora_commons_3">Fedora Commons 3</a>-Objekten, die in einer hierarchischen Beziehung zueinander stehen.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 1. Fedora Object</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Pflicht</th>
<th class="tableblock halign-left valign-top">Beschreibung</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ja</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Von Fedora vorgeschrieben. Wird für die Fedora-interne Suche verwendet</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RELS-EXT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ja</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Von Fedora vorgeschrieben. Wird für viele Sachen verwendet - (1) Hierarchien - (2) Steuerung  der Sichtbarkeiten - (2) OAI-Providing</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nein</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die eigentlichen Daten der Publikation. Oft ein PDF.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metadata oder metadata2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nein</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bibliografische Metadaten. Metadata2 enthält Daten in anlehnung an Lobid 2.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">objectTimestamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nein</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eine Datei mit einem Zeitstempel. Der Zeitstempel wird bei bestimmten Aktionen gesetzt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">seq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nein</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eine Hilfsdatei mit einem JSON-Array. Das Array zeigt an, in welcher Reihenfolge Kindobjekte anzuzeigen sind. Dieses Hilfskonstrukt existiert, da in der RELS-EXT keine RDF-Listen abgelegt werden können.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Die Metadaten werden als ASCII-Kodierte N-Triple abgelegt. Da alle Fedora-Daten als Dateien im Dateisystem abgelegt werden, ist diese Veriante besonders robust gegen Speicherfehler. N-Triple ist ein Format, dass sich Zeilenweise lesen lässt. ASCII ist die einfachste Form der Textkodierung.</p>
</div>
</div>
<div class="sect2">
<h3 id="_namespaces_und_identifier">2.2. Namespaces und Identifier</h3>
<div class="paragraph">
<p>Jede Regal-Installation arbeitet auf einem festgelegten Namespace. Wenn über die <a href="#_regal_api_2">regal-api</a> Objekte angelegt werden, finden sich diese immer in dem entsprechenden Namespace wieder. Hinter dem Namespace findet sich, abgetrennt mit einem Dopplepunkt eine hochlaufende Zahl, die i.d.R. über <a href="#_fedora_commons_3">Fedora Commons 3</a> bezogen wird.</p>
</div>
<div class="paragraph">
<p>Der so zusammengesetzte Identifier kommt in allen Systemkomponenten zum Einsatz.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 2. Beispiel Regal Identifier</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">Komponente</th>
<th class="tableblock halign-left valign-top">URL</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">regal:1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">drupal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost/resource/regal:1" class="bare">http://localhost/resource/regal:1</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">regal:1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">regal-api</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://api.localhost/resource/regal:1" class="bare">http://api.localhost/resource/regal:1</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">regal:1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fedora</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:8080/fedora/objects/regal:1" class="bare">http://localhost:8080/fedora/objects/regal:1</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">regal:1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">elasticsearch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:9200/regal/_all/regal:1" class="bare">http://localhost:9200/regal/_all/regal:1</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_deskriptive_metadaten">2.3. Deskriptive Metadaten</h3>
<div class="paragraph">
<p>Regal unterstützt eine große Anzahl von Metadatenfeldern zur Beschreibung von bibliografischen Ressourcen. Jedes in Regal verspeicherte Objekt kann mit Hilfe von RDF-Metadaten beschrieben werden. Das System verspeichert grundsätzlich alle Metadaten, solange Sie im richtigen Format an die Schnittstelle gespielt werden.</p>
</div>
<div class="paragraph">
<p>Darüberhinaus können über bestimmte Angaben bestimmte weitergehende Funktionen angesteuert werden. Dies betrifft u.A.:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Anzeige und Darstellung</p>
</li>
<li>
<p>Metadatenkonvertierungen</p>
</li>
<li>
<p>OAI-Providing</p>
</li>
<li>
<p>Suche</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Alle bekannten Metadateneinträge werden in der Komponente <a href="#_etikett">etikett</a> verwaltet. In <a href="#_etikett">etikett</a> kann konfiguriert werden, welche URIs aus den RDF-Daten in das JSON-LD-Format von <a href="#_regal_api_2">regal-api</a> überführt werden. Außerdem kann die Reihenfolge der Darstellung, und das Label zur Anzeige gesetzt werden.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 3. Etikett-Eintrag für dc:title</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Label</th>
<th class="tableblock halign-left valign-top">Pictogram</th>
<th class="tableblock halign-left valign-top">Name (json)</th>
<th class="tableblock halign-left valign-top">URI</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Container</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Titel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">keine Angabe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">title</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://purl.org/dc/terms/title" class="bare">http://purl.org/dc/terms/title</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">keine Angabe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">keine Angabe</p></td>
</tr>
</tbody>
</table>
<div class="literalblock">
<div class="title">Etikett-Eintrag als Json</div>
<div class="content">
<pre>"title":{
	"@id"="http://purl.org/dc/terms/title",
	"label"="Titel"
}</pre>
</div>
</div>
<div class="paragraph">
<p>Die etikett Datenbank wird beim Neustart jeder <a href="#_regal_api_2">regal-api</a>-Instanz eingelesen. Außerdem wird die HTTP-Schnittstelle von Etikett immer wieder angesprochen, um zur Anzeige geeignete Labels für URIs in das System zu holen. Das <a href="#_regal_api_2">regal-api</a>-Modul läuft dabei auch ohne den Etikett-Services, allerdings nur mit eingeschränkter Funktionalität; beispielsweise fallen Anzeigen von verlinkten Ressourcen (und das ist in Regal fast alles) weniger schön aus.</p>
</div>
<div class="sect3">
<h4 id="_wie_kommen_bibliografische_metadaten_ins_system">2.3.1. Wie kommen bibliografische Metadaten ins System?</h4>
<div class="paragraph">
<p>In Regal können bibliografische Metadaten aus dem hbz-Verbundkatalog an Ressourcen "angelinkt" werden. Dies erfolgt über Angabe der ID des entsprechenden Titelsatzes (z.b. HT017766754). Mit Hilfe dieser ID kann Regal einen Titelimport durchführen. Dabei wird auf die Schnittstellen der [Lobid-API] zugegriffen.</p>
</div>
<div class="paragraph">
<p>Regal bietet außerdem die Möglichkeit Metadaten über Erfassungsmasken zu erzeugen und zu speichern. Dies erfolgt mit Hilfe des Moduls <a href="#_zettel">zettel</a>. <a href="#_zettel">zettel</a> ist ein Webservices, der verschiedene HTML-Formulare bereitstellt. Die Formulare können RDF-Metadaten einlesen und ausgeben. Zettel-Formulare werden über Javascript in ein IFrame der eigentlichen Anwendung angebunden. Über Zettel werden Konzepte aus dem Bereich Linked Data umgesetzt. So können Feldinhalte über entsprechende Eingabeelemente in Drittsystemen recherchiert und verlinkt werden. Die Darstellung von Links erfolgt in Zettel mit Hilfe von <a href="#_etikett">etikett</a>. Umfangreichere Notationssysteme wie Agrovoc oder DDC werden über einen eigenen Index aus dem Modul <a href="#_skos_lookup">skos-lookup</a> eingebunden. Zettel unterstützt zur Zeit folgende Linked-Data-Quellen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Lobid (GND)</p>
</li>
<li>
<p>Lobid (Ressource)</p>
</li>
<li>
<p>Agrovoc</p>
</li>
<li>
<p>DDC</p>
</li>
<li>
<p>CrossRef (Funder Registry)</p>
</li>
<li>
<p>Orcid</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_anzeige_und_darstellung">2.4. Anzeige und Darstellung</h3>
<div class="paragraph">
<p>Über die Schnittstellen der <a href="#_regal_api_2">regal-api</a> können unterschiedliche Darstellungen einer Publikation bezogen werden. Über [Content Negotiation] können Darstellungen per HTTP-Header angefragt werden. Um unterschiedliche Darstellungen im Browser anzeigen zu lassen, kann außerden, über das Setzen von entsprechenden Endungen, auf unterschiedliche Representationen eine Resource zugegriffen werden.</p>
</div>
<div class="literalblock">
<div class="title">Auswahl von Pfaden zu unterschiedlichen Representationen einer Ressource</div>
<div class="content">
<pre>/resource/danrw:1
/resource/danrw:1.json
/resource/danrw:1.rdf
/resource/danrw:1.epicur
/resource/danrw:1.mets</pre>
</div>
</div>
<div class="paragraph">
<p>In der HTML-Darstellung greift <a href="#_regal_api_2">regal-api</a> auf den Hilfdienst <a href="#_thumby">thumby</a> zu, um darüber Thumbnail-Darstellungen von PDFs oder Bilder zu kreieren. Bei großen Bildern wird außerdem der [DeepzoomerService] angelinkt, der eine Darstellung von Hochauflösenden Bildern über das Tool Openseedragon erlaubt. Video- und Audio-Dateien werden über die entsprechenden HTML5 Elemente gerendert.</p>
</div>
</div>
<div class="sect2">
<h3 id="_der_hbz_verbundkatalog">2.5. Der hbz-Verbundkatalog</h3>
<div class="paragraph">
<p>Metadaten, die über den Verbundkatalog importiert wurden, können über einen Cronjob regelmäßig aktualisiert werden. Außerdem können diese Daten über OAI-PMH an den Verbundkatalog zurückgeliefert werden, so dass dieser Links auf die Volltexte erhält.</p>
</div>
</div>
<div class="sect2">
<h3 id="_metadatenkonvertierung">2.6. Metadatenkonvertierung</h3>
<div class="paragraph">
<p>Für die Metadatenkonvertierung gibt es kein festes Vorgehensmodell oder Werkzeug. I.d.R. gibt es für jede Representation eine oder eine Reihe von Javaklassen, die für eine On-the-fly-Konvertierung sorgen. Die HTML-Darstellung basiert grundlegend auf denselben Daten, die auch im [Elasticsearch]-Index liegen und ist im wesentlichen eine JSON-LD-Darstellung, die mit Hilfe der in <a href="#_etikett">etikett</a> hinterlegten Konfiguration aus den bibliografischen Metadaten gewonnen wurde.</p>
</div>
</div>
<div class="sect2">
<h3 id="_oai_providing">2.7. OAI-Providing</h3>
<div class="paragraph">
<p>Öffentlich zugängliche Publikationen sind auch über die OAI-Schnittstelle verfügbar. Dabei wird jede Publikation einer Reihe von OAI-Sets zugeordnet und in unterschiedlichen Formaten angeboten.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 4. OAI Set</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Set</th>
<th class="tableblock halign-left valign-top">Kriterium</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ddc:*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wenn ein dc:subject mit dem String "http://dewey.info/class/" beginnt, wird ein Set mit der entsprechenden DDC-Nummer gebildet und die Publikation wird zugeordnet</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">contentType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Der "contentType" weist darauf hin, in welcher Weise die Publikation in Regal. Abgelegt ist.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">open_access</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All Publikationen, die als Sichtbarkeit "public" haben</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">urn-set-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Publikationen mit einer URN, die mit urn:nbn:de:hbz:929:01 beginnt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">urn-set-2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Publikationen mit einer URN, die mit urn:nbn:de:hbz:929:02 beginnt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">epicur</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Publikationen, die in einem URN-Set sind</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aleph</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Publikationen , die mit einer Aleph-Id verknüpft sind</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">edoweb01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spezielles, pro <a href="#_regal_api_2">regal-api</a>-Instanz konfigurierbares Set für alle Publikationen, die im aleph-Set sind</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ellinet01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spezielles, pro <a href="#_regal_api_2">regal-api</a>-Instanz konfigurierbares Set für alle Publikationen, die im aleph-Set sind</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 5. OAI Metadatenformat</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Format</th>
<th class="tableblock halign-left valign-top">Kriterium</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">oai_dc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alle öffentlich sichtbaren Objekte, die als bestimmte ContentTypes angelegt wurden.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">epicur</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alle Objekte, die eine URN haben</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aleph</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alle Objekte, die einen persistenten Identifier haben</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wie oai_dc</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rdf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wie oai_dc</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wgl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alle Objekte die über das Feld "collectionOne" einer Institution zugeordnet wurden und über den ContentType "article" eingeliefert urden.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_suche">2.8. Suche</h3>
<div class="paragraph">
<p>Der Elasticsearch-Index wird mit Hilfe einer JSON-LD Konvertierung befüllt. Die Konvertierung basiert im wesentlichen auf den bibliografischen Metadaten der einzelnen Ressourcen und wir mit Hilfe der in <a href="#_etikett">etikett</a> hinterlegten Konfiguration erzeugt.</p>
</div>
</div>
<div class="sect2">
<h3 id="_zugriffsberechtigungen_und_sichtbarkeiten">2.9. Zugriffsberechtigungen und Sichtbarkeiten</h3>
<div class="paragraph">
<p>Regal setzt ein rollenbasiertes Konzept zur Steuerung von Zugriffsberechtigungen um. Eine besondere Bedeutung kommt dem lesenden Zugriff auf Ressourcen zu. Einzelne Ressourcen können in ihrer Sichtbarkeit so eingeschränkt werden, dass nur mit den Rechten einer bestimmten Rolle lesend zugegriffen werden kann. Dabei kann der Zugriff auf Metadaten und Daten separat gesteuert werden.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./resources/images/accessControl.png" alt="Regal Zugriffsrechte">
</div>
<div class="title">Figure 2. Screenshot zur Verdeutlichung von Sichtbarkeiten in Regal</div>
</div>
<div class="paragraph">
<p>Die Konfiguration hat Auswirkungen auf die Sichtbarkeit einer Publikation in den unterschiedlichen Systemteilen. Die folgende Tabelle veranschaulicht den derzeitigen Stand der Implementierung.</p>
</div>
<div class="sect3">
<h4 id="_sichtbarkeiten_operationen_rollen">2.9.1. Sichtbarkeiten, Operationen, Rollen</h4>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 6. Lesender Zugriff auf Metadaten</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sichtbarkeit</th>
<th class="tableblock halign-left valign-top">Rolle</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">public</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GUEST,READER,SUBSCRIBER,REMOTE,ADMIN,EDITOR</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">private</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADMIN,EDITOR</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 7. Lesender Zugriff auf Daten</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sichtbarkeit</th>
<th class="tableblock halign-left valign-top">Rolle</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">public</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GUEST,READER,SUBSCRIBER,REMOTE,ADMIN,EDITOR</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">restricted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">READER,SUBSCRIBER,REMOTE,ADMIN,EDITOR</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">remote</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">READER,SUBSCRIBER,REMOTE,ADMIN,EDITOR</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">single</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SUBSCRIBER,ADMIN,EDITOR</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">private</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADMIN,EDITOR</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_benutzerverwaltung">2.10. Benutzerverwaltung</h3>
<div class="paragraph">
<p>Die Benutzerverwaltung von Regal findet innerhalb von Drupal statt. Zwar können auch in der <a href="#_regal_api_2">regal-api</a> Benutzer angelegt werden, jedoch ist die Implementierung in diesem Bereich erst rudimentär.</p>
</div>
<div class="sect3">
<h4 id="_drupal">2.10.1. Drupal</h4>
<div class="paragraph">
<p>Benutzer in Drupal können über das Modul <a href="#regal_drupal">[regal_drupal]</a> unterschiedliche Rollen zugewiesen werden. Die Authorisierung erfolgt passwortbasiert. Alle Drupal-Benutzer greifen über einen vokonfigurierten Accessor auf die <a href="#_regal_api_2">regal-api</a> zu. Alle Zugriffe erfolgen verschlüsselt unter Angabe eines Passwortes. Die Rolle mit deren Berechtigungen zugegriffen wird, wird dabei in <a href="#regal_drupal">[regal_drupal]</a> gesetzt. Die Drupal-BenutzerId wird als Metadatum in Form eines proprietären HTTP-Headers mit an <a href="#_regal_api_2">regal-api</a> geliefert.</p>
</div>
</div>
<div class="sect3">
<h4 id="_regal_api">2.10.2. Regal-Api</h4>
<div class="paragraph">
<p>Auch in regal-api können Api-Benutzer angelegt werden. Zur Benutzerverwaltung wird eine MySQL-Datenbank eingesetzt, in der die Passworte der Nutzer abgelegt sind (Hash+Salt).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ansichten">2.11. Ansichten</h3>
<div class="paragraph">
<p>Um Daten, die in <a href="#_regal_api_2">regal-api</a> abgelegt wurden zur Anzeige zu bringen sind i.d.R. mehrere Schritte nötig. Die genau Vorgehensweise ist davon abhängig, wo die Daten abgelegt werden. Grundsätzlich basiert die HTML-Darstellung auf den Daten, die unter dem Format <code>.json2</code> einer Ressource abrufbar sind und einen Eintrag in context.json haben.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Eintrag des zugehörigen RDF-Properties in die entsprechende <a href="#_etikett">etikett</a>-Instanz, bzw. in die <code>/conf/labels.json</code>. Der Eintrag muss einen Namen, ein Label und einen Datentyp haben. <a href="#_regal_api_2">regal-api</a> neu starten, bzw mit <code>POST /context.json</code> das neu Laden der Contexteinträge erzwingen.</p>
</li>
<li>
<p>Dies müsste reichen, um eine Standardanzeige in der HTML-Ausgabe zu erreichen</p>
</li>
<li>
<p>Wenn die Daten nicht erscheinen, sollte man überprüfen, ob sie unter dem Format <code>.json2</code> erscheinen. Wenn nicht, stellt sich die Frage, wo die Daten abgelegt werden. Komplett werden nur die Daten aus dem Fedora Datenstrom /metadata2 prozessiert. Befindet sich das Datum in z.B. im /RELS-EXT Datenstrom so muss es zunächst manuell unter <code>helper.JsonMapper#getLd2()</code> in das JSON-Objekt eingefügt werden.</p>
</li>
<li>
<p>Einige Felder werden auch ausgeblendet. Dies geschieht in <a href="#_regal_api_2">regal-api</a> unter <code>/public/stylesheets/main.css</code> und in Drupal innerhalb der entsprechenden themes.</p>
</li>
<li>
<p>Um spezielle Anzeigen zu realisieren muss schließlich im HTML-Template angefasst werden, unter <code>/app/views/tags/resourceView.scala.html</code> .</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Insgesamt läuft es also so: Alles was in <a href="#_etikett">etikett</a> konfiguriert ist, wird auch ins JSON und damit ins HTML übernommen. Dinge, die im HTML nicht benötigt werden, werden über CSS wieder ausgeblendet.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_software">3. Software</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nachfolgend erfolgt eine Innenansicht der einzelnen Module. Die Integration der Module erfolgt i.d.R. über HTTP. Die Module werden über entsprechende Einträge in der Apache-Konfiguration sichtbar gemacht. Es handelt sich also um eine Webservice-Architektur, in der alle Webservices über einen Apache-Webserver und entsprechende Einträge in ihren Konfigurationsdateien miteinander verbunden werden.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./resources/images/regal-dependencies.jpeg" alt="Regal Abhängigkeiten">
</div>
<div class="title">Figure 3. Regal Abhängigkeiten</div>
</div>
<div class="sect2">
<h3 id="_regal_api_2">3.1. regal-api</h3>
<div class="paragraph">
<p>Repo: <a href="https://github.com/edoweb/regal-api" class="bare">https://github.com/edoweb/regal-api</a>
Play 2.4.2</p>
</div>
<div class="paragraph">
<p>Mit regal-api werden alle grundlegenden Funktionen von Regal bereitgestellt. Dies umfasst:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HTTP Schnittstelle</p>
</li>
<li>
<p>Sichtbarkeiten, Zugriffskontrolle, Rollen</p>
</li>
<li>
<p>Speicherung, Datenhaltung</p>
</li>
<li>
<p>Konvertierungen</p>
</li>
<li>
<p>Ansichten</p>
</li>
<li>
<p>Suche</p>
</li>
<li>
<p>Webarchivierung</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Der Webservice ist auf Basis von [Play 2.4.2] realisiert und bietet eine reichhaltig HTTP-API zur Verwaltung von elektronischen Publikationen an. Die <a href="#_regal_api_2">regal-api</a> operiert auf <a href="#_fedora_commons_3">Fedora Commons 3</a>, [MySQL] und [Elasticsearch]. Über die API werden auch Funktionalitäten von <a href="#_etikett">etikett</a>, <a href="#_thumby">thumby</a>, <a href="#_zettel">zettel</a> und <a href="#_deepzoomer">deepzoomer</a> angesprochen. Für die Webarchivierung werden [heritrix], [wpull] und [openwayback] angebunden.</p>
</div>
<div class="sect3">
<h4 id="_kofiguration">3.1.1. Kofiguration</h4>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 8. Dateien im /conf Verzeichnis</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Datei</th>
<th class="tableblock halign-left valign-top">Beschreibung</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>aggregations.conf</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Diese Datei wird verwendet um die Schnittstelle <code>/browse</code> zu konfigurieren. Die Einträg im Object "aggs" können direkt über die <code>/browse</code> Schnittstelle angesprochen werden. Mit Hilfe des Elasticsearch-Indexes wird dann eine entsprechende Antwort generiert. Beispiel: <code>/browse/rdftype</code> liefert eine Liste mit allen Publikationstypen, die im Index vorhanden sind.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>application.conf.tmpl</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eine template Datei für die Hauptkonfiguration von <a href="#_regal_api_2">regal-api</a>. Diese Datei sollte zur lokalen Verwendung einmal nach application.conf kopiert werden. In der Datei sind alle Passwörter auf <em>admin</em> gesetzt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">crawler-beans.cxml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die Datei wird verwendet, wenn im Webarchivierungsmodul eine neue Konfiguration für eine Webseite angelegt wird.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ehcache.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">die Konfiguration der Ehcache Komponente</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fedora-users.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deprecated - Zur Löschung vorgeschlagen</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hbz_edoweb_url.txt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deprecated - Zur Löschung vorgeschlagen</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">html.html</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deprecated - Zur Löschung vorgeschlagen</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">install.properties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deprecated - Zur Löschung vorgeschlagen</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">labels-edoweb.de</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Labels für eine bestimmt Regal-Instanz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">labels-for-proceeding-and-researchData.json</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deprecated - Zur Löschung vorgeschlagen</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">labels-lobid.json</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deprecated - Zur Löschung vorgeschlagen</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">labels-publisso.de</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Labels für eine bestimmte Regal-Instanz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>labels.json</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eine sinnvolle Startkonfiguration. Die Datei wurde mit <a href="#_etikett">etikett</a> erzeugt. Beim Start von <a href="#_regal_api_2">regal-api</a> wird zunächst versucht eine ähnliche Konfiguration direkt von einer laufenden <a href="#_etikett">etikett</a>-Instanz zu holen. Wenn dies nicht klappt, wird auf die labels.json zurückgegriffen.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">list.html</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deprecated - Zur Löschung vorgeschlagen</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logback.developer.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ein logging Konfiguration. Ich kopiere die immer nach logback.developer.js.xml (in .gitignore) und trage sie  dann in die application.conf ein. Auf diese Weise kann ich an Loglevels herumkonfigurieren ohne das in diese Änderungen in die Versionsverwaltung spielen zu müssen.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logback.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Konfiguration des Loggers. Diese Datei ist in application.conf eingetragen.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mabxml-string-template-on-record.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eine template-Datei zur Generierung von MAB-Ausgaben.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mail.properties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Konfiguration zur Versendung von Mails. Standardmäßig schickt die Applikation eine Mail, sobald sie im Production-Mode neu gestartet wurde. Auch der Umzugsservice im Webarchivierungsmodul verschickt Mails.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nwbib-spatial.ttl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deprecated - Zur Löschung vorgeschlagen</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nwbib.ttl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deprecated - Zur Löschung vorgeschlagen</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>public-index-config.json</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Konfiguration des Elasticsearch-Indexes. Da in dem Index vorallem Metadaten liegen, soll fast nicht tokenisiert werden.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>routes</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hier sind alle HTTP-Pfade übersichtlich aufgeführt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scm-info.sh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Diese Datei kann man unter Linux in die profile-Konfiguration seines Benutzers einbinden. Dann erhält man im Terminal farbige Angabgen zu Git-Branches,etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">start-regal.sh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deprecated - Zur Löschung vorgeschlagen</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tomcat-users.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deprecated - Zur Löschung vorgeschlagen</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">unescothes.ttl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deprecated - Zur Löschung vorgeschlagen</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wglcontributor.csv</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deprecated - Zur Löschung vorgeschlagen</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_die_applikation">3.1.2. Die Applikation</h4>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 9. Das /app Verzeichnis</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Package</th>
<th class="tableblock halign-left valign-top">Beschreibung</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">default package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hier befindet sich die Datei Global, die in [Play 2.4] noch eine große Rolle spielt. In der Datei können zum Beispiel Aktionen vor dem Start der Applikation erfolgen, auch können hier HTTP-Requests mit geloggt werden. Bestimmte Aktionen werden nur im Production-Mode ausgeführt, d.h. nur wenn die Applikation mit <code>start</code> gestartet wurde oder über <code>dist</code> ein entsprechendes Binary erzeugt wurde.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">actions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hier sind Funktionen versammelt, die meist unmittelbar aus den Controller-Klassen aufgerufen werden.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">archive.fedora</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ein Reihe von Dateien, über die Zugriffe auf <a href="#_fedora_commons_3">Fedora Commons 3</a> organisiert werden. Hier finden sich auch einige Hilfsklassen (<code>Utils</code>). Das FedoraInterface zeigt an, welche Aktionen auf der Fedora ausgeführt werden. Der Code in diesem Paket gehört mit zu dem ältesten Code im gesamten Regal-Projekt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">archive.search</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zugriff auf die Elasticsearch</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authenticate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Regal verwendet Basic-Auth zur Authentifizierung. Um die entsprechenden Aufrufe in den Controllern zu Schützen wird eine Annotation <code>@BasicAuth</code> verwendet. Diese findet sich hier. Die Annotation selbst bewirkt, dass jeder Controller-Aufruf durch die Methode asicAuth` der Klasse <code>BasicAuthAction.java</code> läuft. Ziel dieser Prozedur ist es, dem Zugriff die Berechtigungen einer bestimmten Rolle zuzuordnen.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">controllers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Der Code, der in diesen Klassen organisiert ist, wird bei den entsprechenden HTTP-Aufrufen ausgeführt. In der <code>/conf/routes</code> Datei kann man sehen, welcher HTTP-Aufruf, welchen Methoden-Aufruf zur Folge hat. Die Controller-Klassen sind i.d.R. von der Klasse MyController  abgeleitet, die Hilfsfunktionen bereitstellt, aber auch Funktionen zur Überprüfung von Zugriffsrechten. Die Überprüfung von Zugriffsrechten erfolgt durch eingebettet Calls und wird über die internen Klassen von MyController realisiert. Beispiel:
Die Funktion <code>listNodes</code> in der Klasse <code>controllers.Resource</code> ruft ihre Prozeduren eingebettet in eine Funktion der Klasse <code>ListAction</code> auf. Die Klasse <code>ListAction</code> ist in <code>MyController</code> implementiert und überprüft, ob der Aufruf mit der nötigen Berechtigung erfolgte.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">converter.mab</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die Klasse realisiert noch das OAI-Providing von MAB-Daten. Ursprünglich war hier geplant, dass wesentlich umfangreichere MAB-Datensätze geliefert werden würden. Daher wird hier mit einer eigenen Template-Engine gearbeitet, etc. Ich erinnere mich gerne an diese Arbeiten, auch wenn sie größtenteils nie genutzt und zu Ende geführt wurden. Ein lustiges Produkt in diesem Kontext ist auch die Klasse <code>models.MabRecord</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">de.hbz.lobid.helper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Der hier befindliche Code kommt ursprünglich aus einem anderen Paket, wurde dann aber beim Neuaufbau des Lobid 2 Datendienstes gemeinsam mit den Kollegen weiterentwickelt und ist schließlich wieder hier gelandet. Mittlerweile ist die offizielle JSON-LD-Library soweit entwickelt, dass man die Konvertierung auch darüber machen kann. Achja, denn dafür ist der Code: Lobid N-Triples in schönes JSON umzuformen, das dann auch in den Elasticsearch-Index kann.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">helper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die mit Abstand wichtigste Klasse in diesem Package heißt <code>JsonMapper</code>. Hier wird das JSON für Index und Ansichten erzeugt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">helper.mail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Emails verschicken.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">helper.oai</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Einige Klassen zur Regelung des OAI-Providings. Der <code>OAIDispatcher</code> analysiert, ob und wie ein <code>Node</code> an die OAI-Schnittstelle gelangt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">models</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die wichtigste Klasse hier ist <code>Node</code> über diese Klasse läuft der Großteil des Datentransportes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">views</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Templates in der Sprache <code>Twirl</code> und einige Java-Hilfsklassen.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">views.mediaViewers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ein paar Viewer, die über die Hilfsklasse <code>ViewerInfo</code> in <code>tags.resourceView</code> eingebunden werden können.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">views.oai</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mit <code>Twirl</code> XML zu generieren war keine gute Idee.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">views.tags</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hilfstemplates.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_gedanken_des_authors">3.1.3. Gedanken des Authors</h4>
<div class="paragraph">
<p>Der in <a href="#_regal_api_2">regal-api</a> versammelte Code ist ein historisch gewachsenes Sammelsurium. Zu irgendeinem Zeitpunkt habe ich angefangen neue Funktionalitäten vorzugsweise nicht mehr hier zu integrieren. Auf diese Weise sind <a href="#_etikett">etikett</a>, <a href="#_thumby">thumby</a>, <a href="#_zettel">zettel</a> und <a href="#_skos_lookup">skos-lookup</a> entstanden.</p>
</div>
<div class="paragraph">
<p>Schaut man sich die sieben groben Aufgabenbereiche an, die von <a href="#_regal_api_2">regal-api</a> abgedeckt werden, so könnten weitere Unterteilungen in zusätzliche Webservices sinnvoll sein. Gerade der Bereich Webarchivierung mit seiner hohen Komplexität erscheint mir für eine Auskopplung prädestiniert. Tools wie [heritrix],[wpull] und [openwayback] könnten so aus der Gesamtkomplexität entfernt werden.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_etikett">3.2. etikett</h3>
<div class="paragraph">
<p>Repo: <a href="https://github.com/hbz/etikett" class="bare">https://github.com/hbz/etikett</a>
Play 2.2.2</p>
</div>
<div class="paragraph">
<p>Etikett ist eine einfache Datenbankanwendung, die es erlaubt menschenlesbare Labels für URIs abzulegen. Über eine HTTP-Schnittstelle kann dann nach dem Label gefragt werden.
In Etikett sind verschiedene Lookups realisiert, die dynamisch Labels für URIs finden können. Beispiele:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Crossref</p>
</li>
<li>
<p>Geonames</p>
</li>
<li>
<p>GND</p>
</li>
<li>
<p>Openstreetmap</p>
</li>
<li>
<p>Orcid</p>
</li>
<li>
<p>RDF, Skos, etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Fragt man etikett nach einem Label, so antwortet Etikett mit dem Ergebnis des Lookups. Wenn Etikett nicht in der Lage ist, ein Label zu finden, wird die URI, mit angefragt wurde, zurückgegeben.</p>
</div>
<div class="paragraph">
<p>Etikett kann auch als Cache verwendet werden. So werden authentifizierte Anfragen in einer Datenbank persistiert. Erneute Anfragen werden dann aus der Datenbank beantwortet, ein erneuter Lookup wird eingespart. Einmal persistierte Labels werden nicht invalidiert. Die Invalidierung kann von außerhalb über authentifizierte HTTP-Zugriffe realisiert werden, stellt aber insgesamt noch ein Desiderat dar.</p>
</div>
<div class="paragraph">
<p>Etikett kann auch mit Labels vorkonfiguriert werden. Dabei können zusätzliche Informationen zu jeder URIs mit abgelegt werden. Folgende Informationen können in etikett abgelegt werden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>URI</p>
</li>
<li>
<p>Label</p>
</li>
<li>
<p>Weight - Zur Definition von Anzeigereihenfolgen.</p>
</li>
<li>
<p>Pictogram Iconfont-ID - Kann anstatt oder zusätzlich zum Label angezeigt werden.</p>
</li>
<li>
<p>ReferenceType - JSON-LD Typ</p>
</li>
<li>
<p>Container - JSON-LD Container</p>
</li>
<li>
<p>Beschreibung - Kommentar als Markdown</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Mit Hilfe dieser Angaben kann Etikett auch einen "JSON-LD Context" bereitstellen. Insgesamt wird über Etikett eine Art "Application Profile" realisiert. Das Profil gibt Auskunft, welche Metadatenfelder (definiert als URIs) in welcher Weise (Typ, Container) Verwendung finden und wie sie angezeigt werden sollen (Label, Weight, Pictogram).</p>
</div>
<div class="paragraph">
<p>Im Regal-Kontext wird <a href="#_etikett">etikett</a> an vielen Stellen verwendet.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Zur Wandlung von RDF nach JSON-LD</p>
</li>
<li>
<p>Zur Anreicherung von RDF Importen</p>
</li>
<li>
<p>Zur menschenlesbaren Darstellung von RDF</p>
</li>
<li>
<p>Zur Konfiguration von Labels, Anzeigereihenfolgen und Pictogrammen</p>
</li>
<li>
<p>Als Cache</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_konfiguration">3.2.1. Konfiguration</h4>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 10. Dateien im /conf Verzeichnis</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Datei</th>
<th class="tableblock halign-left valign-top">Beschreibung</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>evolutions</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dieses Verzeichnis enthält SQL-Skripte, die bei Änderungen des Datenbankschemas automatisch über EBean angelegt werden. Beim nächsten Deployment einer neuen Etikett-Version werden die Skripte automatische angewendet. Die Skripte enthalten immer einen mit "Up" markierten Part, und einen mit "Down" markierten Part (für rollbacks).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>application.conf</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hier kann ein Benutzer eingestellt werden. Alle Klassen im Verzeichnis <code>models.*</code> erhalten eine SQL-Tabelle.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ddc.turtle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eine DDC Datei. Die Datei bietet Labels für DDC-URIs an.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">labels.json</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eine Labels-Datei, die zur initialen Befüllung verwendet werden kann.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">regal.turtle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eine Labels-Datei, die zur initialen Befüllung verwendet werden kann.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>routes</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alle HTTP-Schnittstellen übersichtlich in einer Datei</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rpb.turtle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eine Labels-Datei, die zur initialen Befüllung verwendet werden kann.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rpb2.turtle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eine Labels-Datei, die zur initialen Befüllung verwendet werden kann.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_die_applikation_2">3.2.2. Die Applikation</h4>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 11. Das /app Verzeichnis</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Package</th>
<th class="tableblock halign-left valign-top">Beschreibung</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In <code>Global</code> werden die Requests mit geloggt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">controllers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In <code>Application</code> werden alle HTTP-Operationen implementiert. Unterstützt wird BasicAuth.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">helper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verschiedene Klassen, die eine URI verfolgen und versuchen ein Label aus den zurückgelieferten Daten zu kreieren.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">models</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Model <code>Etikett</code> ist persistierbar.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">views</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die meisten HTTP-Operationen lassen sich auch über eine Weboberfläche im Browser aufrufen.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_zettel">3.3. zettel</h3>
<div class="paragraph">
<p>Repo: <a href="https://github.com/hbz/zettel" class="bare">https://github.com/hbz/zettel</a>
Play 2.5.14</p>
</div>
<div class="paragraph">
<p>Zettel ist ein Webservice zur Bereitstellung von Webformularen. Die Webformulare können über ein HTTP-GET geladen werden. Sollen existierende Daten in ein Formular geladen werden, so können diese Daten als Form-encoded, als JSON, oder als RDF-XML über ein HTTP-POST in das Formular geladen werden. Gleichzeitig kann spezifiziert werden, in welchem Format das Formular Daten zurückliefern soll.</p>
</div>
<div class="paragraph">
<p>Zettel verfügt über keine eigene Speicherschicht. Daten die über ein Formular erzeugt wurden, werden in der HTTP-Response zurückgeliefert. Zur Integration von Zettel in andere Applikationen wurde ein Kommunikationspattern entwickelt, das auf Javascript beruht. Das Zettel-Formular wird hierzu in einem IFrame in die Applikation eingebunden. Die Applikation muss außerdem ein Javascript einbinden, das auf bestimmte Nachrichten aus dem IFrame lauscht. Bei bestimmte Aktionen sendet das Zettel-Formular dann Nachrichten an die Applikation und erlaubt dieser darauf zu reagieren. Um Daten von Zettel in die Applikation zu bekommen, werden diese im HTML-DOM gespeichert und können von dort durch die Applikation entgegengenommen werden.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./resources/images/zettel-flos.png" alt="Zettel Datenfluss">
</div>
<div class="title">Figure 4. Zettel Datenfluss</div>
</div>
<div class="sect3">
<h4 id="_konfiguration_2">3.3.1. Konfiguration</h4>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 12. Dateien im /conf Verzeichnis</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Datei</th>
<th class="tableblock halign-left valign-top">Beschreibung</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>application.conf</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die Datei enthält einen Eintrag zur Konfiguration von <a href="#_etikett">etikett</a>. Über einen weiteren Eintrag können "Hilfetexte" angelinkt werden. Die Hilfetexte müssen in einer statischen HTML abgelegt sein. Am Ende der Datei werden einige Limits deutlich über den Standard erhöht, damit die großen RDF-Posts auch funktionieren.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>collectionOne.csv</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die Datei regelt den Inhalt eines Combo-Box widgets mit id collectionOne.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ddc.csv</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die Datei regelt den Inhalt eines Combo-Box widgets mit id ddc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">labels.json</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ein paar labels, falls keine Instanz von <a href="#_etikett">etikett</a> erreichbar ist.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logback.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logger Konfiguration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>professionalGroup.csv</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die Datei regelt den Inhalt eines Combo-Box widgets mit id professionalGroup.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">routes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alle HTTP-Pfade übersichtlich in einer Datei</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_die_applikation_3">3.3.2. Die Applikation</h4>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 13. Das /app Verzeichnis</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Package</th>
<th class="tableblock halign-left valign-top">Beschreibung</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">controllers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Es gibt nur einen Controller. Hier ist sowohl die Basisfunktionalität implementiert, als auch die Autocompletion-Endpunkte für die unterschiedlichen Widgets. Die Schnittstelle zu Abhandlung von Formulardaten ist recht generisch gehalten. Über eine ID wird das entsprechende Formular aus dem services.ZettelRegister geholt und das zugehörige Formular wird gerendert. Die Formular erhalten dabei unterschiedliche Templates (z.B. <code>views.Article</code>) und unterschiedliche Modelklassen (z.B. models.Article).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">models</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Model "Article" heißt aus historischen Gründen so. Tatsächlich können mittlerweile auch Kongressschriften und Buchkapitel darüber abgebildet werden (vermutlich wird sich der Name nochmal ändern). Das Model "Catalog" dient zum Import von Daten aus dem Aleph-Katalog (über Lobid). Mit ResearchData steht ein prototypisches Model zur Verarbeitung von Daten über Forschungsdaten zur Verfügung. Alle Models basieren auf einem einzigen "fetten" ZettelModel. Das ZettelModel enthält auch Funktionen zur De/Serialisierung in RDF und Json.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">services</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hier werden verschiedene Hilfsklassen versammelt. Die Klasse ZettelFields enthält ein Mapping zur RDF-Deserialisierung.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">views</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alle HTML-Sichten und die eigentlichen Formulare.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_skos_lookup">3.4. skos-lookup</h3>
<div class="paragraph">
<p>Repo: <a href="https://github.com/hbz/skos-lookup" class="bare">https://github.com/hbz/skos-lookup</a>
Play 2.5.8</p>
</div>
<div class="paragraph">
<p><a href="#_skos_lookup">skos-lookup</a> dient zur Unterstützung von <a href="#_zettel">zettel</a>. Der Webservice startet eine eingebettete Elasticsearch-Instanz und verfügt über eine Schnittstelle um SKOS-Daten in separate Indexe zu importieren und Schnittstellen zur Unterstützung von jQuery-Autocomplete- und Select2-Widgets aufzubauen. Auf diese Weise können auch umfangreichere Thesauri und Notationssysteme in den Formularen von <a href="#_zettel">zettel</a> fachgerecht angelinkt werden. <a href="#_skos_lookup">skos-lookup</a> unterstützt auch mehrsprachige Thesauri.</p>
</div>
<div class="sect3">
<h4 id="_konfiguration_3">3.4.1. Konfiguration</h4>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 14. Dateien im /conf Verzeichnis</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Datei</th>
<th class="tableblock halign-left valign-top">Beschreibung</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>application.conf</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hier wird der interne Elasticsearch-Index konfiguriert. Auch werden einige Speichereinstellungen erhöht. Damit auch große SKOS-Dateien geladen werden können, sollten auch die Java-Opts erhöht werden.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logback.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logger Konfiguration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">routes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alle HTTP-Pfade übersichtlich in einer Datei</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">skos-context.json</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ein JSON-LD-Kontext zur Umwandlung von RDF nach JSON. (Origianl von: Jakob Voss)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">skos-setting.json</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings zur Konfiguration des Elasticsearchindexse. (Original von: Jörg Prante)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_die_applikation_4">3.4.2. Die Applikation</h4>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 15. Das /app Verzeichnis</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Package</th>
<th class="tableblock halign-left valign-top">Beschreibung</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">controllers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alles in einem Controller. Die API-Methoden liefern HTML und JSON, so dass man sie aus dem Browser, aber auch über andere Tools ansprechen kann.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">elasticsearch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eine embedded Elasticsearch. Dies hat den Vorteil, dass man eine aktuellere Version nutzen kann, als z.B. die <a href="#_regal_api_2">regal-api</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">services</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hilfsklassen zum Laden der Daten.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">views</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ein Formular um neue Daten in die Applikation zu laden. Und ein Beispielformular zur Demonstration der Nutzung.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_thumby">3.5. thumby</h3>
<div class="paragraph">
<p>Repo: <a href="https://github.com/hbz/thumby" class="bare">https://github.com/hbz/thumby</a>
Play 2.2.2</p>
</div>
<div class="paragraph">
<p><a href="#_thumby">thumby</a> realisiert einen Thumbnail-Generator. Über ein HTTP-GET wird <a href="#_thumby">thumby</a> die URL eines PDFs, oder eines Bildes übergeben. Sofern die <a href="#_thumby">thumby</a> den Server kennt, wird es versuchen ein Thumbnail der zurückgelieferten Daten zu erstellen. Die Daten werden dauerhaft auf der Platte abgelegt und zukünftige Requests, die auf dasselbe Bild verweisen werden direkt aus dem Speicher von <a href="#_thumby">thumby</a> beantwortet.</p>
</div>
<div class="sect3">
<h4 id="_konfiguration_4">3.5.1. Konfiguration</h4>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 16. Dateien im /conf Verzeichnis</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Datei</th>
<th class="tableblock halign-left valign-top">Beschreibung</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>application.conf</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hier wird eine Whitelist gesetzt. Thumby verarbeitet nur URLs von den hier angegebenen Quellen. Hier wird auch der Pfad auf der Platte gesetzt, unter dem Thumby thumbnail-Daten ablegt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">routes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alle HTTP-Pfade übersichtlich in einer Datei</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_die_applikation_5">3.5.2. Die Applikation</h4>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 17. Das /app Verzeichnis</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Package</th>
<th class="tableblock halign-left valign-top">Beschreibung</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">controllers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Der Controller realisiert eine GET-Methode, über die Thumbnails erzeugt und zurückgegeben werden.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">helper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Klassen zur Organisation des Speichers und zur Thumbnailgenerierung.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">views</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Es gibt eine Oberfläche mit einem Upload-Formular.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_deepzoomer">3.6. deepzoomer</h3>
<div class="paragraph">
<p>Repo:<a href="https://github.com/hbz/DeepZoomService" class="bare">https://github.com/hbz/DeepZoomService</a>
Servlet 2.3</p>
</div>
<div class="paragraph">
<p>Der [DeepZoomService] kann als WAR in einem Application-Server deployed werden. Mit dem Deepzoomer können pyramidale Bilder erzeugt, gespeichert und über eine OpenSeadragon-konforme Schnittstelle abgerufen werden. Auf diese Weise kann in Regal eine Viewer-Komponente realisiert werden, die die Anzeige sehr großer, hochaufgelöster Bilder im Webbrowser unterstützt.</p>
</div>
<div class="sect3">
<h4 id="_konfiguration_5">3.6.1. Konfiguration</h4>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 18. Dateien im /conf Verzeichnis</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Datei</th>
<th class="tableblock halign-left valign-top">Beschreibung</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>deepzoomer.cfgf</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hier werden lokale Verzeichnisse, aber auch die Server-URLs, unter denen der Service öffentlich abrufbar ist, gesetzt.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_regal_drupal">3.7. regal-drupal</h3>
<div class="paragraph">
<p>Repo: <a href="https://github.com/edoweb/regal-drupal" class="bare">https://github.com/edoweb/regal-drupal</a>
PHP 5</p>
</div>
<div class="paragraph">
<p>Ein Drupal 7 Modul über das Funktionalitäten der <a href="#_regal_api_2">regal-api</a> angesprochen werden können. Das Modul bietet Oberflächen zur Konfiguration, zur Suche und zur Verwaltung von Objekthierarchien.</p>
</div>
<div class="sect3">
<h4 id="_die_applikation_6">3.7.1. Die Applikation</h4>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 19. Verzeichnisstruktur</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Verzeichnis</th>
<th class="tableblock halign-left valign-top">Beschreibung</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">edoweb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hier ist der Code für die Oberflächen.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">edoweb-field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hier werden Felder für unterschiedliche RDF-Properties in der Drupal-Datenbank konfiguriert. Der Code ist größtenteils obsolet, da die Feldlogik nicht mehr benutzt wird.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">edoweb_storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hier sind die Zugriffe auf <a href="#_regal_api_2">regal-api</a> und [elasticsearch] zu finden.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_edoweb_drupal_theme">3.8. edoweb-drupal-theme</h3>
<div class="paragraph">
<p>Repo: <a href="https://github.com/edoweb/edoweb-drupal-theme" class="bare">https://github.com/edoweb/edoweb-drupal-theme</a>
PHP 5</p>
</div>
<div class="paragraph">
<p>Eine Reihe von Stylsheets, CSS, Icons zur Gestaltung einer Oberfläche für den Server <a href="https://edoweb-rlp.de" class="bare">https://edoweb-rlp.de</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_zbmed_drupal_theme">3.9. zbmed-drupal-theme</h3>
<div class="paragraph">
<p>Repo: <a href="https://github.com/edoweb/zbmed-drupal-theme" class="bare">https://github.com/edoweb/zbmed-drupal-theme</a>
PHP 5</p>
</div>
<div class="paragraph">
<p>Eine Reihe von Stylsheets, CSS, Icons zur Gestaltung einer Oberfläche für den Server <a href="https://repository.publisso.de" class="bare">https://repository.publisso.de</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_openwayback">3.10. openwayback</h3>
<div class="paragraph">
<p>Repo: <a href="https://github.com/iipc/openwayback" class="bare">https://github.com/iipc/openwayback</a>
Servlet 2.5</p>
</div>
<div class="paragraph">
<p><strong>Achtung</strong>: Es gibt einen am hbz entwickelten Branch. Dieser ist nicht auf Github.</p>
</div>
<div class="paragraph">
<p>Openwayback ist eine Webapplikation die im ROOT Bereich eines Tomcats installiert werden will. Sie kann Verzeichnisse mit WARC-Dateien indexieren und darauf eine Oberfläche zur Recherche und zur Navigation aufbauen.</p>
</div>
</div>
<div class="sect2">
<h3 id="_heritrix">3.11. heritrix</h3>
<div class="paragraph">
<p>Heritrix ist ein Werkzeug zur Sammlung von Webseiten. Heritrix startet standalone als Webapplikation und bietet eine Weboberfläche zur Verwaltung von Sammelvorgängen an. Eingesammelte Webseiten werden als WARC-Dateien in einem bestimmten Bereich der Platte abgelegt.</p>
</div>
</div>
<div class="sect2">
<h3 id="_wpull">3.12. wpull</h3>
<div class="paragraph">
<p>Wpull ist ein Kommandozeilen-Wermzeug zur Sammlung von Webseiten. Mit WPull können WARC-Dateien erzeugt werden.</p>
</div>
</div>
<div class="sect2">
<h3 id="_fedora_commons_3">3.13. Fedora Commons 3</h3>
<div class="paragraph">
<p>Fedora Commons 3 ist ein Repository-Framework. Für Regal wird vorallem die Speicherschicht von Fedora Commons 3 benutzt. Fedora-Commons legt alle Daten im Dateisystem (auch) ab. Mit den Daten aus dem Dateisystem lässt sich eine komplette Fedora-Commons 3 Instanz von grundauf neu aufbauen.</p>
</div>
</div>
<div class="sect2">
<h3 id="_mysql">3.14. MySql</h3>
<div class="paragraph">
<p>MySQL wir von Fedora, regal-api und etikett verwendet.</p>
</div>
</div>
<div class="sect2">
<h3 id="_elasticsearch_1_1">3.15. Elasticsearch 1.1</h3>
<div class="paragraph">
<p>Elasticsearch ist eine Suchmaschine und wird von <a href="#_regal_api_2">regal-api</a> verwendet. Auch <a href="#regal_drupal">[regal_drupal]</a> greift auf den Index zu.</p>
</div>
</div>
<div class="sect2">
<h3 id="_drupal_7">3.16. Drupal 7</h3>
<div class="paragraph">
<p>Über Drupal 7</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation">4. Installation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_vagrant">4.1. Vagrant</h3>
<div class="paragraph">
<p>Zur Veranschaulichung dieser Dokumentation wird ein Vagrant-Skript angeboten, mit dem eine Regal-Installation innerhalb eines VirtualBox-Images erzeugt werden kann.</p>
</div>
<div class="paragraph">
<p>Zur Installation kannst Du folgende Schritte ausführen. Die Kommandos beziehen sich auf die Installation auf einem Ubuntu-System. Für andere Betriebssyteme ist die Installation ähnlich.</p>
</div>
<div class="paragraph">
<p>Die VirtualBox hat folgendes Setup</p>
</div>
<div class="ulist">
<ul>
<li>
<p>hdd 40GB</p>
</li>
<li>
<p>cpu 2core</p>
</li>
<li>
<p>ram 4096G</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_virtualbox_installieren">4.1.1. VirtualBox installieren</h4>
<div class="literalblock">
<div class="content">
<pre>sudo apt-get install virtualbox</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_vagrant_installieren">4.1.2. Vagrant installieren</h4>
<div class="literalblock">
<div class="content">
<pre>cd /tmp
wget https://releases.hashicorp.com/vagrant/2.2.3/vagrant_2.2.3_x86_64.deb
sudo dpkg -i vagrant_2.2.3_x86_64.deb</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_repository_herunterladen">4.1.3. Repository herunterladen</h4>
<div class="literalblock">
<div class="content">
<pre>git clone https://github.com/jschnasse/Regal
cd Regal/vagrant/ubuntu-14.04</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_eine_jdk8_bereitstellen">4.1.4. Eine JDK8 bereitstellen</h4>
<div class="paragraph">
<p>Hierfür bitte ein JDK8-Tarball herunterladen und unter dem Namen <code>java8.tar.gz</code> in einem Verzeichnis <code>/bin</code> unterhalb des Vagrant-Directories bereitstellen.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mkdir bin
mv ~/downloads/jdk.... bin/java8.tar.gz</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_geteiltes_entwicklungsverzeichnis">4.1.5. Geteiltes Entwicklungsverzeichnis</h4>
<div class="literalblock">
<div class="content">
<pre>mkdir ~/regal-dev</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_vagrant_guest_additions_installieren">4.1.6. Vagrant Guest Additions installieren</h4>
<div class="literalblock">
<div class="content">
<pre>vagrant plugin install vagrant-vbguest &amp;&amp; vagrant reload</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_vagrant_starten">4.1.7. Vagrant starten</h4>
<div class="literalblock">
<div class="content">
<pre>vagrant up</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_auf_der_maschine_einloggen">4.1.8. Auf der Maschine einloggen</h4>
<div class="literalblock">
<div class="content">
<pre>vagrant ssh</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_server">4.2. Server</h3>
<div class="paragraph">
<p>Die Installation auf einem Server kann mit Hilfe des mitgelieferten Skriptes erfolgen.</p>
</div>
<div class="sect3">
<h4 id="_hardware_empfehlung">4.2.1. Hardware Empfehlung</h4>
<div class="ulist">
<ul>
<li>
<p>hdd &gt;500GB</p>
</li>
<li>
<p>cpu 8 core</p>
</li>
<li>
<p>ram 32 G</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_unterschiede_zur_vagrant_installation">4.2.2. Unterschiede zur Vagrant Installation</h4>
<div class="paragraph">
<p>Auf dem Server empfehlen ich den fedora tomcat mit erweiterten Speichereinstellungen zu betreiben.</p>
</div>
<div class="paragraph">
<p>Dazu in <code>/opt/regal/bin/fedora/tomcat/bin</code> eine <code>setenv.sh</code> anlegen und folgende Zeilen hinein kopieren.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CATALINA_OPTS=" \
-Xms1536m \
-Xmx1536m \
-XX:NewSize=256m \
-XX:MaxNewSize=256m \
-XX:PermSize=256m \
-XX:MaxPermSize=256m \
-server \
-Djava.awt.headless=true \
-Dorg.apache.jasper.runtime.BodyContentImpl.LIMIT_BUFFER=true"

export CATALINA_OPTS</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_administration">5. Administration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_aktualisierung">5.1. Aktualisierung</h3>
<div class="sect3">
<h4 id="_play_applikationen">5.1.1. Play-Applikationen</h4>
<div class="paragraph">
<p>Die Aktualisierung der Regal-Komponenten erfolgt über Skripte. Die Aktualisierung funktioniert dabei so, dass der Quellcode der zu aktualisierenden Komponente unter <code>/opt/regal/src</code> per <code>git</code> auf den entsprechenden Branch gestellt wird. Danach wird ein neues Kompilat der Komponente erzeugt. Die aktuelle Konfiguration wird aus <code>/opt/regal/conf</code> genommen und es wird unter <code>/opt/regal/apps</code> eine neue lauffähige Version abgelegt.</p>
</div>
<div class="paragraph">
<p>Neue Versionen werden immer parallel zu alten Versionen gestartet und über einen Wechsel der Apachekonfiguration aktiviert. Erst danach wird die alte Version heruntergefahren.</p>
</div>
<div class="paragraph">
<p>Der komplette Aktualisierungsprozess erfolgt automatisch. Die alte Version bleibt immer auf dem Server liegen, so dass bei Bedarf wieder zurück gewechselt werden kann.</p>
</div>
</div>
<div class="sect3">
<h4 id="_tomcat_applikation">5.1.2. Tomcat-Applikation</h4>
<div class="paragraph">
<p>Es wird ein <code>war</code>-Container erzeugt und im Tomcat <code>hot</code>-deployed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_drupal_module">5.1.3. Drupal-Module</h4>
<div class="paragraph">
<p>Beinhaltet die Akutalisierung ein Datenbankupdate, so wird Drupal erst in den Wartungszustand versetzt (per drush oder über die Oberfläche). Danach wird die aktualisierte Version einfach per Git geholt. Bei Datenbankupdates wird noch ein Drupal-Updateskript ausgeführt.</p>
</div>
</div>
<div class="sect3">
<h4 id="_speicherschicht">5.1.4. Speicherschicht</h4>
<div class="paragraph">
<p>Aktualisierungen von MySQL, Elasticsearch und Fedora gehen mit einer Downtime einher.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_verzeichnisse">5.2. Verzeichnisse</h3>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 20. Verzeichnisstruktur</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Verzeichnis</th>
<th class="tableblock halign-left valign-top">Beschreibung</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/regal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Außer Apache2, Elasticsearch und MySQL befinden sich alle Regal-Komponenten unter diesem Verzeichnis.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/regal/apps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die auf <code>Play</code> beruhenden Komponenten:  <code>etikett  fedora  regal-api  skos-lookup  thumby  zettel</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/regal/bin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fremdpakete wie activator, fedora, heritrix, python - weitere tomcats.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/regal/conf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die variables.conf und die application.conf wird von verschiedenen Komponenten verwendet.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/regal/logs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logfiles der Skripte und Cronjobs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/regal/src</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alle Eigenentwicklungen oder im Quellcode modifizierten Komponenten.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/regal/var</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">drupal und Datenverzeichnisse.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_ports">5.3. Ports</h3>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 21. Ports und Komponenten (typische Belegung)</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Port</th>
<th class="tableblock halign-left valign-top">Komponente</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">80 /443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apache 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fedora tomcat</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9090</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">openwayback tomcat</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">elasticsearch</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9000/9100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">regal-api</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9001/9101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">thumby</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9002/9102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">etikett</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9003/9103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zettel</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9004/9104</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">skos-lookup</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_logs">5.4. Logs</h3>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 22. Logfiles</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Komponente</th>
<th class="tableblock halign-left valign-top">Pfad</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apache</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/log/apache2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tomcat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/regal/bin/fedora/tomcat/logs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fedora</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/regal/bin/fedora/server/logs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elasticsearch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/log/elasticsearch</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">regal-api</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/regal/apps/regal-api/logs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">drupal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/log/apache2 #otherhosts ! und/var/log/apache2/error.log (hier ist auch die Debugausgabe)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MySql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/log/mysql</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">monit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/log/monit.log</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">regal-scripts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/regal/logs</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_configs">5.5. Configs</h3>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 23. Configfiles</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Komponente</th>
<th class="tableblock halign-left valign-top">Pfad</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apache</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/etc/apache2/sites-enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tomcat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/regal/bin/fedora/tomcat/conf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fedora</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/regal/bin/fedora/server/conf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elasticsearch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/etc/elasticsearch</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">regal-api</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/regal/conf enthält Konfigurationsvorschläge des Installers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">regal-api</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/regal/apps/regal-api/conf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">drupal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Konfig kann gut mit dem Tool drush überwacht werden</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elasticsearch Plugins</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/etc/elasticsearch</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">oai-pmh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/regal/bin/fedora/tomcat/webapps/dnb-unr/WEB-INF/classes/proai.properties</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">monit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/etc/monit</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_apache2">5.6. Apache2</h3>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 24. Frontend Pfade</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Komponente</th>
<th class="tableblock halign-left valign-top">HTTP-Pfad</th>
<th class="tableblock halign-left valign-top">Lokaler Pfad/Proxy</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Drupal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/regal/var/drupal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alte Importe von Webarchiven</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/webharvests</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/data/webharvests</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Täglich generierte Datei mit Kennziffern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/crawlreports</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/regal/crawlreports</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 25. API Pfade</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Komponente</th>
<th class="tableblock halign-left valign-top">HTTP-Pfad</th>
<th class="tableblock halign-left valign-top">Lokaler Pfad/Proxy</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Über wget erstellte Webarchive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/wget-data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/regal/var/wget-data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Über wpull erstellte Webarchive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/wpull-data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/regal/var/wpull-data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Über heritrix erstellte Webarchive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/heritrix-data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/regal/var/heritrix-data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OAI-Schnittstelle für die DNB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/dnb-urn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:8080/dnb-urn$1" class="bare">http://localhost:8080/dnb-urn$1</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OAI-Schnittstelle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/oai-pmh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:8080/oai-pmh$1" class="bare">http://localhost:8080/oai-pmh$1</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deepzoomer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/deepzoom</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:7080/deepzoom$1" class="bare">http://localhost:7080/deepzoom$1</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Openwayback privat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/wayback</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:9080/wayback" class="bare">http://localhost:9080/wayback</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Openwayback öffentlich</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/weltweit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:9080/weltweit" class="bare">http://localhost:9080/weltweit</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thumby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/tools/thumby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:9001/tools/thumby" class="bare">http://localhost:9001/tools/thumby</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Etikett</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/tools/etikett</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:9002/tools/etikett" class="bare">http://localhost:9002/tools/etikett</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zettel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/tools/zettel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:9004/tools/zettel" class="bare">http://localhost:9004/tools/zettel</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elasticsearch GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/search</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:9200" class="bare">http://localhost:9200</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fedora</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/fedora</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:8080/fedora" class="bare">http://localhost:8080/fedora</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON-LD Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/public/resources.json</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:9002/tools/etikett/context.json" class="bare">http://localhost:9002/tools/etikett/context.json</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">regal-api</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:9000/" class="bare">http://localhost:9000/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">heritrix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/tools/heritrix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://localhost:8443/tools/heritrix" class="bare">https://localhost:8443/tools/heritrix</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_matomo">5.7. Matomo</h3>
<div class="paragraph">
<p>Matomo wird einmal täglich per Cronjob mit Apache-Logfiles befüllt. Dabei erfolgt eine Anonymisierung. Die Logfiles verbleiben noch sieben
Tage auf dem Server und werden dann annoynmisiert.</p>
</div>
</div>
<div class="sect2">
<h3 id="_monit">5.8. Monit</h3>
<div class="paragraph">
<p>Das Tool Monit erlaubt es, den Status der Regal-Komponenten zu überwachen und Dienste ggfl. neu zu starten. Folgende Einträge können in /etc/monit/monitrc vorgenommen werden</p>
</div>
<div class="literalblock">
<div class="content">
<pre>check process apache with pidfile /var/run/apache2/apache2.pid
    start program = "/etc/init.d/apache2 start" with timeout 60 seconds
    stop program  = "/etc/init.d/apache2 stop"

check process regal-api with pidfile /opt/regal/apps/regal-api/RUNNING_PID
     start program = "/etc/init.d/regal-api start" with timeout 60 seconds
     stop program = "/etc/init.d/regal-api stop"

check process tomcat6 with pidfile /var/run/tomcat6.pid
     start program = "/etc/init.d/tomcat6 start" with timeout 60 seconds
     stop program = "/etc/init.d/regal-api stop"

check process elasticsearch with pidfile /var/run/elasticsearch.pid
     start program = "/etc/init.d/elasticsearch start" with timeout 60 seconds
     stop program = "/etc/init.d/elasticsearch stop"

check process thumby with pidfile /opt/regal/apps/thumby/RUNNING_PID
     start program = "/etc/init.d/thumby start" with timeout 60 seconds
     stop program = "/etc/init.d/thumby stop"

check process etikett with pidfile /opt/regal/apps/etikett/RUNNING_PID
     start program = "/etc/init.d/etikett start" with timeout 60 seconds
     stop program = "/etc/init.d/etikett stop"

check process zettel with pidfile /opt/regal/apps/zettel/RUNNING_PID
     start program = "/etc/init.d/zettel start" with timeout 60 seconds
     stop program = "/etc/init.d/zettel stop"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_scripts_und_cronjobs">5.9. Scripts und Cronjobs</h3>
<div class="paragraph">
<p>Für das Funktionieren von Regal sind einige regal-scripts sinnvoll. Die Skripte sind sämtlich unter Github zu finden.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/edoweb/regal-scripts" class="bare">https://github.com/edoweb/regal-scripts</a></p>
</div>
<div class="paragraph">
<p>Die folgenden Abschnitte zeigen ein typisches Setup.</p>
</div>
<div class="sect3">
<h4 id="_oai_providing_2">5.9.1. OAI-Providing</h4>
<div class="paragraph">
<p>Der OAI-Provider läuft nicht die ganze Zeit mit, da dies Probleme gemacht hat. Er wird nur für einen bestimmten Zeitraum angestellt und dann wieder ausgestellt. Auf diese Weise liefert die OAI-Schnittstelle tagesaktuelle Daten.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>0 2 * * * /opt/regal/src/regal-scripts/turnOnOaiPmhPolling.sh
0 5 * * * /opt/regal/src/regal-scripts/turnOffOaiPmhPolling.sh</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_urn_registrierung">5.9.2. URN-Registrierung</h4>
<div class="paragraph">
<p>Die URN-Registrierung erfolgt mit einem gewissen Verzug. Das dafür zuständige Skript überprüft daher zunächst das Anlagedatum der Ressource.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>05 7 * * * /opt/regal/src/regal-scripts/register_urn.sh control  &gt;&gt; /opt/regal/regal-scripts/log/control_urn_vergabe.log
1 1 * * * /opt/regal/src/regal-scripts/register_urn.sh katalog &gt;&gt; /opt/regal/regal-scripts/log/katalog_update.log
1 0 * * * /opt/regal/src/regal-scripts/register_urn.sh register &gt;&gt; /opt/regal/regal-scripts/log/register_urn.log</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_katalog_aktualisierung">5.9.3. Katalog-Aktualisierung</h4>
<div class="paragraph">
<p>Das System gleicht einmal am Tag Metadaten mit dem hbz-Verbundkatalog ab und führt ggf. Aktualisierungen durch.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>0 5 * * * /opt/regal/src/regal-scripts/updateAll.sh &gt; /dev/null</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_matomo_2">5.9.4. Matomo</h4>
<div class="paragraph">
<p>Matomo wird mit Apache-Logfiles befüllt. Innerhalb von Matomo werden die Einträge annonymisiert.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>0 1 * * * /opt/regal/regal-scripts/import-logfiles.sh &gt;/dev/null</pre>
</div>
</div>
<div class="paragraph">
<p>Logfile Annonymisierung
<sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup></p>
</div>
<div class="paragraph">
<p>Apache-Logfiles werden sieben Tage unverändert aufbewahrt. Danach erfolgt eine Annonymisierung.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>0 2 * * * /opt/regal/src/regal-scripts/depersonalize-apache-logs.sh</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_webgatherer">5.9.5. Webgatherer</h4>
<div class="paragraph">
<p>Der Webgatherer prüft Archivierungsintervalle von Webpages und stößt bei Bedarf die Erzeugung eines neuen Snapshots/Version an.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>0 20 * * * /opt/regal/src/regal-scripts/runGatherer.sh &gt;&gt; /opt/regal/regal-scripts/log/runGatherer.log
# Auswertung des letzten Webgatherer-Laufs
0 21 * * * /opt/regal/src/regal-scripts/evalWebgatherer.sh &gt;&gt; /opt/regal/regal-scripts/log/runGatherer.log
# Crawl Reports
0 22 * * * /opt/regal/src/regal-scripts/crawlReport.sh &gt;&gt; /opt/regal/logs/crawlReport.log</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_backup">5.9.6. Backup</h4>
<div class="paragraph">
<p>MySQL und Elasticsearch</p>
</div>
<div class="paragraph">
<p>Der Elasticsearch-Index und die MySQL-Datenbanken werden täglich gesichert. Es werden Backups der letzten 30 Tage aufbewahrt. Ältere Backups werden von der Platte gelöscht.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>0 2 * * * /opt/regal/src/regal-scripts/backup-es.sh -c &gt;&gt; /opt/regal/logs/backup-es.log 2&gt;&amp;1
30 2 * * * /opt/regal/src/regal-scripts/backup-es.sh -b &gt;&gt; /opt/regal/logs/backup-es.log 2&gt;&amp;1
0 2 * * * /opt/regal/src/regal-scripts/backup-db.sh -c &gt;&gt; /opt/regal/logs/backup-db.log 2&gt;&amp;1
30 2 * * * /opt/regal/src/regal-scripts/backup-db.sh -b &gt;&gt; /opt/regal/logs/backup-db.log 2&gt;&amp;1</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_entwicklung">5.9.7. Entwicklung</h4>
<div class="paragraph">
<p>Für die Entwicklung an Regal empfiehlt sich folgende Vorgehensweise&#8230;&#8203;</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dokumentation">6. Dokumentation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Diese Dokumentation ist mit asciidoc geschrieben und wurde mit asciidoctor in HTML übersetzt. Dazu wurde das foundation.css Stylesheet aus dem asciidoctor-stylesheet-factory Repository verwendet.</p>
</div>
<div class="paragraph">
<p>Die Schritte, um an der Doku zu arbeiten sind folgenden</p>
</div>
<div class="sect2">
<h3 id="_diese_repo_herunterladen">6.1. Diese Repo herunterladen</h3>
<div class="literalblock">
<div class="content">
<pre>git clone https://github.com/jschnasse/Regal</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_asciidoctor_und_asciidoctor_stylesheets_installieren">6.2. Asciidoctor und Asciidoctor-Stylesheets installieren</h3>
<div class="literalblock">
<div class="content">
<pre>gpg --keyserver hkp://pool.sks-keyservers.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB
\curl -sSL https://get.rvm.io | sudo bash -s stable --ruby
#login again
sudo apt-get install bundler
sudo apt-get install gem
git clone https://github.com/asciidoctor/asciidoctor
git clone https://github.com/asciidoctor/asciidoctor-stylesheet-factory
cd asciidoctor
sudo gem install asciidoctor
cd ../asciidoctor-stylesheet-factory
bundle install
compass compile</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_doku_modifizieren_und_in_html_übersetzen">6.3. Doku modifizieren und in HTML übersetzen</h3>
<div class="literalblock">
<div class="content">
<pre>cd Regal/doc
editor regal.txt
asciidoctor -astylesheet=foundation.css -astylesdir=../../asciidoctor-stylesheet-factory/stylesheets regal.txt</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_license">7. License</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<a class="image" href="http://creativecommons.org/licenses/by-nc/4.0/"><img src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" alt="88x31"></a>
</div>
</div>
<div class="paragraph">
<p>This work is licensed under a <a href="http://creativecommons.org/licenses/by-nc/4.0/&gt;">Creative Commons Attribution-NonCommercial 4.0 International License</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_links">8. Links</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_slides">8.1. Slides</h3>
<div class="ulist">
<ul>
<li>
<p>Lobid - <a href="http://hbz.github.io/slides/" class="bare">http://hbz.github.io/slides/</a></p>
</li>
<li>
<p>Skos-Lookup - <a href="http://hbz.github.io/slides/siit-170511/#/" class="bare">http://hbz.github.io/slides/siit-170511/#/</a></p>
</li>
<li>
<p>Regal - <a href="http://hbz.github.io/slides/danrw-20180905/#/" class="bare">http://hbz.github.io/slides/danrw-20180905/#/</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_internes_wiki">8.2. Internes Wiki</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://wiki1.hbz-nrw.de/display/edd/Dokumentation" class="bare">https://wiki1.hbz-nrw.de/display/edd/Dokumentation</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_github">8.3. Github</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/edoweb" class="bare">https://github.com/edoweb</a></p>
</li>
<li>
<p><a href="https://github.com/hbz" class="bare">https://github.com/hbz</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-05-10 11:44:32 +0200
</div>
</div>
</body>
</html>